---
# Shengwang Platform Configuration
#
# Platform: Shengwang Conversational AI (China)
# URL: https://conversational-ai.shengwang.cn/
# Authentication: Required (email/password or storage state)
#
# Setup Modes:
#   - storage: Use saved storage state (fastest)
#   - account: Login with email and password (SSO)
#   - manual: Manual login in browser window
name: shengwang
description: Shengwang Conversational AI (China)
config:
  home_url: https://conversational-ai.shengwang.cn/
  sso_login_url: https://sso.shengwang.cn/login
auth:
  default_mode: auto
  auto_fallback: [storage, account, manual]
# Platform actions
actions:
  # ==========================================================================
  # Setup Actions (Authentication)
  # ==========================================================================

  # Storage Mode: Use saved storage state (fastest)
  setup:storage:
    - type: browser.navigate
      url: ${config.home_url}
    - type: control.sleep
      duration: 2000
    - type: browser.load_storage_state
      file: ${params.storage_file}
    - type: browser.refresh
      timeout_ms: 30000
    - type: control.sleep
      duration: 3000
    - type: browser.wait_for_url
      pattern: ${config.home_url}
      timeout_ms: 10000
    - type: control.log
      message: Shengwang setup completed (storage mode)

  # Account Mode: Login with email and password (SSO)
  setup:account:
    - type: browser.navigate
      url: ${config.home_url}
    - type: control.sleep
      duration: 3000
    # Click account login button on home page
    - type: browser.click
      selector: button:has-text('账号登录')
      timeout_ms: 10000
    - type: control.sleep
      duration: 2000
    # Accept privacy policy in popup
    - type: browser.click
      selector: button:has-text('同意')
      timeout_ms: 10000
    - type: control.sleep
      duration: 1000
    # Check terms and conditions checkbox
    - type: browser.set_checkbox
      selector: button[role='checkbox'][id='terms']
      checked: true
      timeout_ms: 10000
    # Click login button to enter SSO page
    - type: browser.click
      selector: button.bg-icontext.w-full:has-text('登录')
      timeout_ms: 10000
    - type: control.sleep
      duration: 3000
    # Wait for SSO page to load
    - type: browser.wait_for_element
      selector: button[id='radix-vue-tabs-v-1-trigger-email']
      state: visible
      timeout_ms: 10000
    # Switch to email login tab
    - type: browser.click
      selector: button[id='radix-vue-tabs-v-1-trigger-email']
      timeout_ms: 10000
    - type: control.sleep
      duration: 1000
    # Fill email address
    - type: browser.fill
      selector: input[type='text'].custom-input
      value: ${params.email}
      timeout_ms: 10000
    # Fill password
    - type: browser.fill
      selector: input[type='password'].custom-input
      value: ${params.password}
      timeout_ms: 10000
    - type: control.sleep
      duration: 1000
    # Wait for login button to become enabled
    - type: browser.wait_for_element
      selector: button.ssp-button:has-text('登录'):not([disabled])
      state: visible
      timeout_ms: 10000
    # Submit login form
    - type: browser.click
      selector: button.ssp-button:has-text('登录')
    - type: browser.wait_for_url
      pattern: ${config.home_url}
      timeout_ms: 60000
    - type: control.sleep
      duration: 3000
    - type: browser.save_storage_state
      file: ${params.storage_file}
    - type: control.log
      message: Shengwang setup completed (account mode)

  # Manual Mode: User completes login manually
  setup:manual:
    - type: browser.navigate
      url: ${config.home_url}
    - type: control.sleep
      duration: 3000
    - type: control.log
      message: ⏸️  Please complete login in the browser window
    - type: control.log
      message: Waiting for login completion (user avatar button should appear)...
    # Wait for user avatar button (only appears after login)
    - type: browser.wait_for_element
      selector: button:has(svg circle[cx="16"])
      state: visible
      timeout_ms: 300000
    - type: control.log
      message: ✅ Login detected (user avatar appeared), saving state...
    - type: control.sleep
      duration: 3000
    - type: browser.save_storage_state
      file: ${params.storage_file}
    - type: control.log
      message: ✅ Storage state saved

  # ==========================================================================
  # Conversation Actions
  # ==========================================================================

  # Enter: Start conversation with default agent
  enter:
    - type: browser.click
      selector: button:has-text('连接对话式 AI 引擎')
      timeout_ms: 10000
    - type: control.sleep
      duration: 3000
    - type: control.log
      message: Shengwang conversation started

  # Enter with agent selection
  enter:select_agent:
    - type: browser.click
      selector: button:has-text('${params.agent_name}')
      timeout_ms: 10000
    - type: browser.click
      selector: button:has-text('连接对话式 AI 引擎')
      timeout_ms: 10000
    - type: control.sleep
      duration: 3000
    - type: control.log
      message: 'Shengwang conversation started with agent: ${params.agent_name}'

  # Exit: End conversation
  exit:
    - type: browser.click
      selector: button.text-destructive:has(svg.lucide-x)
      timeout_ms: 10000
    - type: control.sleep
      duration: 2000
    - type: control.log
      message: Shengwang conversation ended
